<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ui/ui.scroll.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">首页 Home</a></h2><h3>类Classes</h3><ul><li><a href="Gom.html">Gom</a><ul class='methods'><li data-type='method'><a href="Gom.html#.Utils">Utils</a></li></ul></li><li><a href="Gom.App.html">App</a><ul class='methods'><li data-type='method'><a href="Gom.App.html#getCRO">getCRO</a></li><li data-type='method'><a href="Gom.App.html#getLastHashByLastIndex">getLastHashByLastIndex</a></li><li data-type='method'><a href="Gom.App.html#goto">goto</a></li><li data-type='method'><a href="Gom.App.html#run">run</a></li><li data-type='method'><a href="Gom.App.html#setCRO">setCRO</a></li></ul></li><li><a href="Gom.Page.html">Page</a><ul class='methods'><li data-type='method'><a href="Gom.Page.html#destory">destory</a></li><li data-type='method'><a href="Gom.Page.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.Page.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.Page.html#offview">offview</a></li><li data-type='method'><a href="Gom.Page.html#onview">onview</a></li><li data-type='method'><a href="Gom.Page.html#push">push</a></li><li data-type='method'><a href="Gom.Page.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.Page.html#render">render</a></li><li data-type='method'><a href="Gom.Page.html#setHeader">setHeader</a></li><li data-type='method'><a href="Gom.Page.html#setSeo">setSeo</a></li><li data-type='method'><a href="Gom.Page.html#show">show</a></li><li data-type='method'><a href="Gom.Page.html#update">update</a></li></ul></li><li><a href="Gom.Service.html">Service</a><ul class='methods'><li data-type='method'><a href="Gom.Service.html#ajax">ajax</a></li><li data-type='method'><a href="Gom.Service.html#fetch">fetch</a></li><li data-type='method'><a href="Gom.Service.html#get">get</a></li><li data-type='method'><a href="Gom.Service.html#jsonp">jsonp</a></li><li data-type='method'><a href="Gom.Service.html#post">post</a></li><li data-type='method'><a href="Gom.Service.html#save">save</a></li><li data-type='method'><a href="Gom.Service.html#tmpl">tmpl</a></li></ul></li><li><a href="Gom.UI.html">UI</a></li><li><a href="Gom.UI.Button.html">Button</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Button.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Button.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Button.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Button.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Button.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Button.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Button.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Button.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Button.html#update">update</a></li></ul></li><li><a href="Gom.UI.Form.html">Form</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Form.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Form.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Form.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Form.html#getStore">getStore</a></li><li data-type='method'><a href="Gom.UI.Form.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Form.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Form.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Form.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Form.html#setStore">setStore</a></li><li data-type='method'><a href="Gom.UI.Form.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Form.html#update">update</a></li></ul></li><li><a href="Gom.UI.Header.html">Header</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Header.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Header.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Header.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Header.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Header.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Header.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Header.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Header.html#setTitle">setTitle</a></li><li data-type='method'><a href="Gom.UI.Header.html#setTitle">setTitle</a></li><li data-type='method'><a href="Gom.UI.Header.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Header.html#update">update</a></li></ul></li><li><a href="Gom.UI.InputLocation.html">InputLocation</a><ul class='methods'><li data-type='method'><a href="Gom.UI.InputLocation.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#render">render</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#show">show</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#update">update</a></li></ul></li><li><a href="Gom.UI.List.html">List</a><ul class='methods'><li data-type='method'><a href="Gom.UI.List.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.List.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.List.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.List.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.List.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.List.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.List.html#render">render</a></li><li data-type='method'><a href="Gom.UI.List.html#show">show</a></li><li data-type='method'><a href="Gom.UI.List.html#update">update</a></li></ul></li><li><a href="Gom.UI.Modal.html">Modal</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Modal.html#.alert">alert</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.bottom">bottom</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.bottom">bottom</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.center">center</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.confirm">confirm</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.layout">layout</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.loading">loading</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.popover">popover</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.tips">tips</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.top">top</a></li><li data-type='method'><a href="Gom.UI.Modal.html#autoHide">autoHide</a></li><li data-type='method'><a href="Gom.UI.Modal.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getMask">getMask</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getModal">getModal</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getType">getType</a></li><li data-type='method'><a href="Gom.UI.Modal.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Modal.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Modal.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Modal.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Modal.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Modal.html#toggleModal">toggleModal</a></li><li data-type='method'><a href="Gom.UI.Modal.html#update">update</a></li></ul></li><li><a href="Gom.UI.Radio.html">Radio</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Radio.html#fresh">fresh</a></li><li data-type='method'><a href="Gom.UI.Radio.html#fresh">fresh</a></li><li data-type='method'><a href="Gom.UI.Radio.html#fresh">fresh</a></li><li data-type='method'><a href="Gom.UI.Radio.html#getItem">getItem</a></li><li data-type='method'><a href="Gom.UI.Radio.html#getItem">getItem</a></li></ul></li><li><a href="Gom.UI.Scroll.html">Scroll</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Scroll.html#getSteps">getSteps</a></li><li data-type='method'><a href="Gom.UI.Scroll.html#hideFresh">hideFresh</a></li><li data-type='method'><a href="Gom.UI.Scroll.html#scrollTo">scrollTo</a></li><li data-type='method'><a href="Gom.UI.Scroll.html#showFresh">showFresh</a></li></ul></li><li><a href="Gom.UI.Select.html">Select</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Select.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Select.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Select.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Select.html#getSelect">getSelect</a></li><li data-type='method'><a href="Gom.UI.Select.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Select.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Select.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Select.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Select.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Select.html#update">update</a></li></ul></li><li><a href="Gom.UI.Sides.html">Sides</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Sides.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Sides.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Sides.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Sides.html#getSides">getSides</a></li><li data-type='method'><a href="Gom.UI.Sides.html#hide">hide</a></li><li data-type='method'><a href="Gom.UI.Sides.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Sides.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Sides.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Sides.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Sides.html#setContent">setContent</a></li><li data-type='method'><a href="Gom.UI.Sides.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Sides.html#update">update</a></li></ul></li><li><a href="Gom.UI.Slide.html">Slide</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Slide.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Slide.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Slide.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Slide.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Slide.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Slide.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Slide.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Slide.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Slide.html#update">update</a></li></ul></li><li><a href="Gom.UI.Toggle.html">Toggle</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Toggle.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#update">update</a></li></ul></li><li><a href="Gom.View.html">View</a><ul class='methods'><li data-type='method'><a href="Gom.View.html#.template">template</a></li><li data-type='method'><a href="Gom.View.html#destory">destory</a></li><li data-type='method'><a href="Gom.View.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.View.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.View.html#offview">offview</a></li><li data-type='method'><a href="Gom.View.html#onview">onview</a></li><li data-type='method'><a href="Gom.View.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.View.html#render">render</a></li><li data-type='method'><a href="Gom.View.html#show">show</a></li><li data-type='method'><a href="Gom.View.html#update">update</a></li></ul></li></ul><h3>命名空间 Namespaces</h3><ul><li><a href="store.html">store</a><ul class='methods'><li data-type='method'><a href="store.html#.del">del</a></li><li data-type='method'><a href="store.html#.del">del</a></li><li data-type='method'><a href="store.html#.each">each</a></li><li data-type='method'><a href="store.html#.get">get</a></li><li data-type='method'><a href="store.html#.has">has</a></li><li data-type='method'><a href="store.html#.noexpire">noexpire</a></li><li data-type='method'><a href="store.html#.size">size</a></li></ul></li><li><a href="url.html">url</a><ul class='methods'><li data-type='method'><a href="url.html#.getHashPath">getHashPath</a></li><li data-type='method'><a href="url.html#.getHashSearch">getHashSearch</a></li><li data-type='method'><a href="url.html#.getHTML5Hash">getHTML5Hash</a></li><li data-type='method'><a href="url.html#.getParams">getParams</a></li><li data-type='method'><a href="url.html#.getUrl">getUrl</a></li><li data-type='method'><a href="url.html#.set">set</a></li><li data-type='method'><a href="url.html#.setParam">setParam</a></li></ul></li></ul><h3>Global 全局</h3><ul><li><a href="global.html#easingMap">easingMap</a></li><li><a href="global.html#re">re</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html#swipe">swipe</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">ui/ui.scroll.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//引入插件时没有参数，因为插件在框架里全局运行， 这就要求框架引入依赖的zepto需在框架之前
import $ from '../utils/fx';
import $$ from '../utils/swipe';

//水平或垂直滚动的面板，just it;
var vendor = (/webkit/i).test(navigator.appVersion) ? 'webkit' :
    (/firefox/i).test(navigator.userAgent) ? 'Moz' :
        'opera' in window ? 'O' : '';
var has3d = 'WebKitCSSMatrix' in window &amp;&amp; 'm11' in new WebKitCSSMatrix();
var getFreshStr = function(moveStr, freshStr){
    return `&lt;div class="pull-to-refresh-layer">
    &lt;div class="pull-show-item">&lt;span class="preloader-text">${moveStr}&lt;/span>&lt;span class="preloader">&lt;/span>&lt;/div>
    &lt;div class="pull-show-item">&lt;span class="pull-to-refresh-text">${freshStr}&lt;/span>&lt;span class="pull-to-refresh-arrow">&lt;/span>&lt;/div>
    &lt;/div>`;
};
/**
 * @class Gom.UI.Scroll
 * @alias Scroll
 * @param {object} opts 参列
 * opts.wrapper     require 滚动对象所在的容器
 * opts.className   require className 滚动对象的className
 * opts.step        options 步长 默认0 不计步长，滚动的结果一定是以此为单位, 滚屏网站时可以一屏一步长,
 *                  非滚动选择组件(time, district..)一般不用此属性,否则滚动以步长计不会具体到点
 * opts.outer       options 允许出界的范围,默认100
 * opts.outerFront       options 自定义front出界显示的html,false时没有，''时有默认，指定时显示指定
 * opts.outerEnd         options 同上
 * opts.frontText  options 允许出界位置上面显示的html或文字
 * opts.endText  options 允许出界位置上面显示的html或文字
 * opts.speed 1     0与1之间  速度控制，默认1，在time选择器时设置小更容易选择，在页面滚动设置为1较好。
 * opts.outerEnd    允许出界位置下面显示的html或文字
 * opts.direction   options vertical/horizontal 默认为垂直 水平与垂直
 * opts.onScroll    options 每次滚动时回调 回调里的this指向本实例
 * opts.endScroll   options 每次滚动停回调 回调里的this指向本实例
 * opts.onFront       options 滚动到上时 回调里的this指向本实例
 * opts.onEnd    options 滚动到下时 回调里的this指向本实例
 //* opts.scrollBar options 是否显示滚动条
 * @example 实例
 * new Scroll({
         wrapper    : '.scroll-example2',    //滚动对象所在的容器
         className  : '.scroll-content',      //滚动对象的className
         direction  : 'vertical', //'vertical',             //水平与垂直
         step       : 0, // 不设置步长
         outer:       允许出界的范围
         frontText : '允许出界位置上面显示的html或文字',
         EndText   : '允许出界位置下面显示的html或文字',
         onScroll: function(point){ },    //每次滚动时回调
         endScroll: function(point){ console.log('单次滚动结束'); }, //   每次滚动停回调
         onFront: function(){ console.log('滚动到最上面，滚动停止时触发')},       //滚动到上时
         onEnd:  function(){ console.log('滚动到最下面，滚动停止时触发')}   // 滚动到下时
    });
 */
class Scroll {
    constructor  (opts) {
        opts.direction = opts.direction || 'vertical';

        var frontText = opts.frontText || '上拉刷新', endText = opts.endText || '下拉加载';
        var $el = $(opts.wrapper);
        var defalutsThis = {
            $wrapper : $el,
            $scroll  : $el.find(opts.className),
            step     : opts.step || 0,
            speed    : opts.speed || 1,
            outer    : opts.outer===void 0 ? 100 : opts.outer,
            isX      : opts.direction !== 'vertical',
            onScroll : opts.onScroll || function(){},
            endScroll: opts.endScroll || function(){},
            onFront  : opts.onFront || function(){},
            onEnd    : opts.onEnd || function(){}
        };

        if(!defalutsThis.isX &amp;&amp; Number(defalutsThis.outer)>0){
            defalutsThis.outerFront = opts.outerFront===false?'':(opts.outerFront?opts.outerFront:getFreshStr('正在为您刷新', frontText));
            defalutsThis.outerEnd =  opts.outerEnd===false?'':(opts.outerEnd?opts.outerEnd:getFreshStr('正在拼命加载中...', endText));
        }
        $.extend(this, defalutsThis);
        this.construct();
    }
    construct (){
        this.$scroll.addClass('gom-scroll');
        this.bindScroll();
    }
    bindScroll (){
        var that = this, $wrapper = this.$wrapper, direct = this.isX?'horizontal':'vertical';
        if(this.outerFront){
            $wrapper.prepend('&lt;div class="ui-scroll-front gom-scroll-out">'+this.outerFront+'&lt;/div>');
        }
        if(this.outerEnd){
         $wrapper.prepend('&lt;div class="ui-scroll-end gom-scroll-out pull-up">'+this.outerEnd+'&lt;/div>');
        }

        var swipeOpts = {
            //swipeY: 30,
            moveCallback (point){
                that._setScrollTrans(point, true);},
            endCallback (point){
                that._setScrollTrans(point, false);
            }
        };
        this.isX ?
        $wrapper.addClass('ui-scroll ui-scroll-'+direct).swipeLeft(swipeOpts).swipeRight(swipeOpts):
        $wrapper.addClass('ui-scroll ui-scroll-'+direct).swipeTop(swipeOpts).swipeBottom(swipeOpts);
    }
    //滑动区域尺寸，纵向滚动获取总高度，横向滚动获取总宽
    getScrollSize (){
        return !this.isX ? this.$scroll.height() : this.$scroll.width();
    }
    //容器高度
    getWrapperSize () {
        return !this.isX ? this.$wrapper.height() : this.$wrapper.width();
    }
    //滚动到 num, elem, top, bottom
    /**
     * 滚动到...
     * @method Gom.UI.Scroll#scrollTo
     * @param {object} where 可以为具体的数字，元素, top, bottom字符串
     * @param {function} callback 滚动到后回调
     */
    scrollTo (where, callback){
        var toType = typeof  where, val;
        if(where === 'top'){
            val = 0;
        }else if(where === 'bottom'){
            val = -this.getMaxTrans();
        }
        if(toType === 'number'){
            val = where;
        }
        this._scrollFxTo(val, callback);
        console.log(this.getSteps(), '滚动的步长为：');
    }

    /**
     * 设置了step时获取滚动了多少步长
     * @method Gom.UI.Scroll#getSteps
     * @return  {number} 步长数
     */
    getSteps (){
        return   this.$scroll.data('swipe-steps') || 0;
    }
    _scrollFxTo (val, callback){
        //有步长值的话以步长计
        if(this.step){
            var vals = this._getTransStep(val);
            console.log(vals, '步长信息');
            val = vals.val;
            this.$scroll.data('swipe-steps', vals.stepNum);
        }
        console.log('set data swipe offset');
        this.$scroll.data('swipe-offset', val);
        this.$scroll.fx(this._scrollCount(val), 'normal', 'linear', callback?callback:function(){});  //, 'normal', 'easeOutQuint'
    }
    //滚动时回调（moving为true为事件中回调，false为事件结束时回调）
    _setScrollTrans (point, moving){
        var distance = this.isX ? point.swipeX : point.swipeY;
        var transVal = this._getTransVal(distance, point.swipeTime, moving);
        var transStr = this._scrollCount(transVal);
        if(moving){
            this.$scroll.css(transStr);
            this.onScroll(point);
        }else{
            //hold住时不回弹,用于上拉刷新时等待刷新结果
            if(!this.hold){
                this._scrollFxTo(transVal); //!this.hold ? transVal : $('.pull-to-refresh-layer').height()
            }
            this.endScroll(point);
        }
    }
    /**
     * 滚动到顶请求数据时需要调用，一般用于onFront显示刷新请求数据，成功后调用hideFresh()隐藏刷新
     * @method Gom.UI.Scroll#showFresh
     * @param {string} [pos=front] 显示刷新，头部刷新front,尾部end
     * @return  {number} 步长数
     */
    showFresh (pos){
        pos = pos || 'front';
        $('.ui-scroll-'+pos).addClass('refreshing').removeClass('pull-up');
        this.hold = true;
    }
    /**
     * 滚动到底请求数据时需要调用
     * @method Gom.UI.Scroll#hideFresh
     * @param {string} [pos=front] 隐藏刷新，头部刷新front,尾部end
     * @return  {number} 步长数
     */
    hideFresh (pos){
        pos = pos || 'front';
        var that = this;
        var toPos = pos==='front'?0:-(this.getMaxTrans());
        that.scrollTo(toPos, function(){
            $('.ui-scroll-'+pos).removeClass('refreshing');
            that.hold = false;
        });
    }
    getMaxTrans (){
        return this.getScrollSize() - this.getWrapperSize();
    }
    //hold时与滑动时的边界是带有outer的， 滑动停止时的边界不带有outer值，
    rangeCheck (dis, moving){
        var maxTransDis = this.getMaxTrans(),
            maxOuter    = moving ? this.outer : 0,
            maxRange = maxTransDis + maxOuter;

        if(dis > maxOuter){
            dis = maxOuter;
        }else if(Math.abs(dis) > maxRange){
            dis = -maxRange;
        }
        return dis;
    }
    //计算当前滚动到的并限制边界范围
    _getTransVal (distance, swipeTime, moving){

        //限制区域
        var maxTransDis = this.getMaxTrans(),
            maxOuter    = this.outer,
            maxRange = maxTransDis + maxOuter,
            singleSwipeDis = distance,
            swipeOffset = this.$scroll.data('swipe-offset') || 0;
            distance += swipeOffset;

        if(0>distance &amp;&amp; distance>=-maxTransDis){
            distance = moving ? distance : singleSwipeDis*this._getRatio(swipeTime)+swipeOffset;
        }
        var absDis = Math.abs(distance), disBefChk = distance;
            distance = this.rangeCheck(distance, moving);

        console.log(swipeOffset, moving, distance, maxTransDis, maxRange,  this._getRatio(swipeTime), this.getScrollSize(), this.getWrapperSize());

        if(!this.outer){
            return distance;
        }

        var $usf = $('.ui-scroll-front');
        var $use = $('.ui-scroll-end');
        //在顶端越界时(使用的是最后一个absDis,因为distance在rangeCheck后不是拖动后的最后状态)
        if(distance >= 0 &amp;&amp; this.outerFront){
            $usf.show();
            //超过outer一半时箭头变化
            if(disBefChk &lt;= maxOuter/2){
                $usf.removeClass('pull-up');
            }else if(disBefChk > maxOuter/2){
                $usf.addClass('pull-up');
                if(!moving  &amp;&amp; swipeOffset===0){
                    this.showFresh();
                    this.onFront();
                }
            }
            if(!moving){ //moveEnd时
                $usf.removeClass('pull-up');
                distance = 0;
            }
        }

        if(absDis > maxTransDis &amp;&amp; this.outerEnd){
            $use.show();
            var moveOutDis = maxRange-absDis;
            //超过outer一半时箭头变化
            if(moveOutDis &lt;= maxOuter/2){
                $use.removeClass('pull-up');
                if(!moving &amp;&amp; swipeOffset===-maxTransDis){
                    this.showFresh('end');
                    this.onEnd();
                }
            }else if(moveOutDis > maxOuter/2){
                $use.addClass('pull-up');
            }
            if(!moving){ //moveEnd时
                $use.addClass('pull-up');
                distance = -maxTransDis;
            }
        }
        return distance;
    }

    //计算当前滚动到的并限制步长结果的值,返回步长数与与滚动步长的值
    _getTransStep (val){
        var step = this.step, stepNum = Math.round(val/step);
        return {
            stepNum: Math.abs(stepNum),
            val: step*stepNum
        };
    }
    //暂停回弹
    _holdScroll (){
        this.hold = true;
    }
    //根据swipe时间计算滚动速度
    _getRatio (swipeTime){
        var ratio, speedval = this.speed*1000;
        if(swipeTime > speedval){
            ratio = 1;
        }else{
            ratio = speedval/swipeTime;
            ratio = ratio > 20 ? 20 : ratio;
        }
        return ratio;
    }

    //根据值计算滚动translate对象
    _scrollCount (val){
        var isX =  this.isX;       //水平垂直
        var x = isX ? (val+'px') : '0',
            y = isX ? '0' : (val+'px');
        var props = {};
        props['-'+ vendor + '-transform'] = has3d ?
        "translate3d("+x+","+y+",0)" :
        "translate("+x+","+y+")";
        return props;
    }

}
export default Scroll;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.0-dev</a> on Sun Jan 17 2016 16:54:24 GMT+0800 (CST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
