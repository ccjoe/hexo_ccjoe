<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>core/app.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">首页 Home</a></h2><h3>类Classes</h3><ul><li><a href="Gom.html">Gom</a><ul class='methods'><li data-type='method'><a href="Gom.html#.Utils">Utils</a></li></ul></li><li><a href="Gom.App.html">App</a><ul class='methods'><li data-type='method'><a href="Gom.App.html#getCRO">getCRO</a></li><li data-type='method'><a href="Gom.App.html#getLastHashByLastIndex">getLastHashByLastIndex</a></li><li data-type='method'><a href="Gom.App.html#goto">goto</a></li><li data-type='method'><a href="Gom.App.html#run">run</a></li><li data-type='method'><a href="Gom.App.html#setCRO">setCRO</a></li></ul></li><li><a href="Gom.Page.html">Page</a><ul class='methods'><li data-type='method'><a href="Gom.Page.html#destory">destory</a></li><li data-type='method'><a href="Gom.Page.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.Page.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.Page.html#offview">offview</a></li><li data-type='method'><a href="Gom.Page.html#onview">onview</a></li><li data-type='method'><a href="Gom.Page.html#push">push</a></li><li data-type='method'><a href="Gom.Page.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.Page.html#render">render</a></li><li data-type='method'><a href="Gom.Page.html#setHeader">setHeader</a></li><li data-type='method'><a href="Gom.Page.html#setSeo">setSeo</a></li><li data-type='method'><a href="Gom.Page.html#show">show</a></li><li data-type='method'><a href="Gom.Page.html#update">update</a></li></ul></li><li><a href="Gom.Service.html">Service</a><ul class='methods'><li data-type='method'><a href="Gom.Service.html#ajax">ajax</a></li><li data-type='method'><a href="Gom.Service.html#fetch">fetch</a></li><li data-type='method'><a href="Gom.Service.html#get">get</a></li><li data-type='method'><a href="Gom.Service.html#jsonp">jsonp</a></li><li data-type='method'><a href="Gom.Service.html#post">post</a></li><li data-type='method'><a href="Gom.Service.html#save">save</a></li><li data-type='method'><a href="Gom.Service.html#tmpl">tmpl</a></li></ul></li><li><a href="Gom.UI.html">UI</a></li><li><a href="Gom.UI.Button.html">Button</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Button.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Button.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Button.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Button.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Button.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Button.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Button.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Button.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Button.html#update">update</a></li></ul></li><li><a href="Gom.UI.Form.html">Form</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Form.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Form.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Form.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Form.html#getStore">getStore</a></li><li data-type='method'><a href="Gom.UI.Form.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Form.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Form.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Form.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Form.html#setStore">setStore</a></li><li data-type='method'><a href="Gom.UI.Form.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Form.html#update">update</a></li></ul></li><li><a href="Gom.UI.Header.html">Header</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Header.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Header.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Header.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Header.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Header.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Header.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Header.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Header.html#setTitle">setTitle</a></li><li data-type='method'><a href="Gom.UI.Header.html#setTitle">setTitle</a></li><li data-type='method'><a href="Gom.UI.Header.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Header.html#update">update</a></li></ul></li><li><a href="Gom.UI.InputLocation.html">InputLocation</a><ul class='methods'><li data-type='method'><a href="Gom.UI.InputLocation.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#render">render</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#show">show</a></li><li data-type='method'><a href="Gom.UI.InputLocation.html#update">update</a></li></ul></li><li><a href="Gom.UI.List.html">List</a><ul class='methods'><li data-type='method'><a href="Gom.UI.List.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.List.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.List.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.List.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.List.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.List.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.List.html#render">render</a></li><li data-type='method'><a href="Gom.UI.List.html#show">show</a></li><li data-type='method'><a href="Gom.UI.List.html#update">update</a></li></ul></li><li><a href="Gom.UI.Modal.html">Modal</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Modal.html#.alert">alert</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.bottom">bottom</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.bottom">bottom</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.center">center</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.confirm">confirm</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.layout">layout</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.loading">loading</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.popover">popover</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.tips">tips</a></li><li data-type='method'><a href="Gom.UI.Modal.html#.top">top</a></li><li data-type='method'><a href="Gom.UI.Modal.html#autoHide">autoHide</a></li><li data-type='method'><a href="Gom.UI.Modal.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getMask">getMask</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getModal">getModal</a></li><li data-type='method'><a href="Gom.UI.Modal.html#getType">getType</a></li><li data-type='method'><a href="Gom.UI.Modal.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Modal.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Modal.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Modal.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Modal.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Modal.html#toggleModal">toggleModal</a></li><li data-type='method'><a href="Gom.UI.Modal.html#update">update</a></li></ul></li><li><a href="Gom.UI.Radio.html">Radio</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Radio.html#fresh">fresh</a></li><li data-type='method'><a href="Gom.UI.Radio.html#fresh">fresh</a></li><li data-type='method'><a href="Gom.UI.Radio.html#fresh">fresh</a></li><li data-type='method'><a href="Gom.UI.Radio.html#getItem">getItem</a></li><li data-type='method'><a href="Gom.UI.Radio.html#getItem">getItem</a></li></ul></li><li><a href="Gom.UI.Scroll.html">Scroll</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Scroll.html#getSteps">getSteps</a></li><li data-type='method'><a href="Gom.UI.Scroll.html#hideFresh">hideFresh</a></li><li data-type='method'><a href="Gom.UI.Scroll.html#scrollTo">scrollTo</a></li><li data-type='method'><a href="Gom.UI.Scroll.html#showFresh">showFresh</a></li></ul></li><li><a href="Gom.UI.Select.html">Select</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Select.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Select.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Select.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Select.html#getSelect">getSelect</a></li><li data-type='method'><a href="Gom.UI.Select.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Select.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Select.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Select.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Select.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Select.html#update">update</a></li></ul></li><li><a href="Gom.UI.Sides.html">Sides</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Sides.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Sides.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Sides.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Sides.html#getSides">getSides</a></li><li data-type='method'><a href="Gom.UI.Sides.html#hide">hide</a></li><li data-type='method'><a href="Gom.UI.Sides.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Sides.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Sides.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Sides.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Sides.html#setContent">setContent</a></li><li data-type='method'><a href="Gom.UI.Sides.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Sides.html#update">update</a></li></ul></li><li><a href="Gom.UI.Slide.html">Slide</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Slide.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Slide.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Slide.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Slide.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Slide.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Slide.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Slide.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Slide.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Slide.html#update">update</a></li></ul></li><li><a href="Gom.UI.Toggle.html">Toggle</a><ul class='methods'><li data-type='method'><a href="Gom.UI.Toggle.html#destory">destory</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#offview">offview</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#onview">onview</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#render">render</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#show">show</a></li><li data-type='method'><a href="Gom.UI.Toggle.html#update">update</a></li></ul></li><li><a href="Gom.View.html">View</a><ul class='methods'><li data-type='method'><a href="Gom.View.html#.template">template</a></li><li data-type='method'><a href="Gom.View.html#destory">destory</a></li><li data-type='method'><a href="Gom.View.html#getHTMLFragment">getHTMLFragment</a></li><li data-type='method'><a href="Gom.View.html#getHTMLTmpl">getHTMLTmpl</a></li><li data-type='method'><a href="Gom.View.html#offview">offview</a></li><li data-type='method'><a href="Gom.View.html#onview">onview</a></li><li data-type='method'><a href="Gom.View.html#refreshEvent">refreshEvent</a></li><li data-type='method'><a href="Gom.View.html#render">render</a></li><li data-type='method'><a href="Gom.View.html#show">show</a></li><li data-type='method'><a href="Gom.View.html#update">update</a></li></ul></li></ul><h3>命名空间 Namespaces</h3><ul><li><a href="store.html">store</a><ul class='methods'><li data-type='method'><a href="store.html#.del">del</a></li><li data-type='method'><a href="store.html#.del">del</a></li><li data-type='method'><a href="store.html#.each">each</a></li><li data-type='method'><a href="store.html#.get">get</a></li><li data-type='method'><a href="store.html#.has">has</a></li><li data-type='method'><a href="store.html#.noexpire">noexpire</a></li><li data-type='method'><a href="store.html#.size">size</a></li></ul></li><li><a href="url.html">url</a><ul class='methods'><li data-type='method'><a href="url.html#.getHashPath">getHashPath</a></li><li data-type='method'><a href="url.html#.getHashSearch">getHashSearch</a></li><li data-type='method'><a href="url.html#.getHTML5Hash">getHTML5Hash</a></li><li data-type='method'><a href="url.html#.getParams">getParams</a></li><li data-type='method'><a href="url.html#.getUrl">getUrl</a></li><li data-type='method'><a href="url.html#.set">set</a></li><li data-type='method'><a href="url.html#.setParam">setParam</a></li></ul></li></ul><h3>Global 全局</h3><ul><li><a href="global.html#easingMap">easingMap</a></li><li><a href="global.html#re">re</a></li><li><a href="global.html#storage">storage</a></li><li><a href="global.html#swipe">swipe</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">core/app.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Page from '../core/page';
import * as Modal from  '../ui/ui.modal';
import * as Url from '../utils/url';
import Store from '../utils/store';
    /**
 * App对象
 * @class Gom.App
 * @alias App
 * @param {object} config -App配置选项config,
 * @param {boolean} [config.DEBUG=false] -DEBUG模式(无缓存,可见源码)
 * @param {boolean} [config.GOM_PATH]    -requirejs引入Gom时需要定义， 在html直接引入gom.js文件时不需要配置
 * @param {boolean} [config.API_HOST]    -建议将站点请求服务端的host配置于此
 * @param {boolean} [config.STORE_VIEWS] -是否缓存页面于本地
 * @param {number} [config.EXPIRES]     -缓存页面时长，会过期
 * @param {object} [config.CLASSES]     -页面布局类的className配置,尽量默认不要改变
 * @param {object[]} route              - CRO对象集合, App配置选项router，见route.js,
 * @return {app}
 * @example 传入配置文件与路由文件
 *
config需要定义为全局变量，因为框架也需要用到
var config = {
DEBUG: true,
GOM_PATH: '/gom/build/gom',
API_HOST: 'http://h5.jc.me:3000/api/',    //服务端API HOST
STORE_VIEWS: true,                        //缓存模板
EXPIRES: 24,                              //缓存时间(小时)
CLASSES: {                                //站点ID配置
    VIEWPORT: '#viewport',                //页面Viewport
    HEADER: '#header',                    //Header ID
    FOOTER: '#footer',                    //Footer ID
    CONTENT: '.gom-content'                   //页面交替内容
}
};
new App(config, route).run();

有关Webapp内的跳转说明：
站内链接地址必须是形如：  '?module/sub' 的形式(如果调用此类的方法需要传入hashPath，则要传入的格式是module/sub)
站间链接才需要加上 http://host
 */

class App {
    constructor (config={}, route={}) {
        this.config = config;
        this.route = route;
        this.model = {};
        this.history = [];
    }
    /**
     * 启动GomApp
     * @method Gom.App#run
     * @param {function} [callback] - 在初始Gom.App时的需要完全的工作可以定义在callback
     */
    run (callback){       //Gom.App初始化
        var that = this;
        var isHistoryApi = !!(window.history &amp;&amp; history.pushState);
        if(!isHistoryApi){
            return;
        }
        History.Adapter.bind(window, 'statechange', () => {
            var state = History.getState();
            state.data.hash = state.data.hash || Url.getHTML5Hash(state.hash) || '/'; //首次进来默认取state.hash
            that.goto(state.data.hash);
        });
        History.Adapter.trigger(window, 'statechange');
        callback ? callback() : null;
        this._initHref();
    }

    _initHref (){
        //对所有链接进行html5处理
        //? 站内链接跳转
        //# 站内组件或hash跳转
        //http:// 站间跳转
        //''为空时当作非链接处理
        $("body").off().on("click", 'a', function(){
            var $t = $(this),
                href = $t.attr('href');

            if(!href || !!~href.indexOf('#') || !href.indexOf('javascript:')) return; //无链接或不存在hash或存在javascript:跳转不处理
            History.pushState({hash: href, prevHash: location.search}, $t.attr('title'), href);
            return false;
        }).on('click', '.icon-left-nav', function(){
            History.go(-1);
            return false;
        });
    }
    //设置了isbug即不读localStorage,否则读设置的值。
    getViewTmpl (tmplname, callback){
        var  that = this, expires = +that.config.EXPIRES;
        if(expires>0){
            var view = Store.get(tmplname);
            if(!!view){
                callback?callback(view):null;
                return;
            }
        }
        $.ajax({url:'views/'+tmplname+'.html', dataType:'html', success  (tmpl){
            if(expires>0){
                Store.set(tmplname, tmpl, expires);
            }
            callback?callback(tmpl):null;
        }});
    }

    setPage (opts){
        if(!opts){
            return;
        }
        opts.config = this.config;
        opts.isback = this.isBack();
        return new Page(opts);
    }
    /**
     * 根据完整hash获取页面对象(即具体路由指向的路由表对象)
     * 路由查找规则，根据hash路径数据长度查找CRO对应对象，在每个长度的index找不到则查找'/:var'， 在最后index有‘/’则查找'/';
     * @todo 如果index=0都没有找到，还是到首页吧，因为在其它环境时（如在app里，会默认加上?appinfo导致解析问题）
     * @method Gom.App#getCRO
     * @param {string} hashPath hashPath是形如 module/list  module/123的值
     * @return {object} CRO (Current Router Object)返回具体路由指向的路由表对象
     */
    getCRO  (hashPath){
        var router = this.route;

        if(typeof hashPath !== 'string') return {};
        if(hashPath === '/') return router['/'];

        var hashRoute = hashPath.split('/');
        var CRO = router, hashLen = hashRoute.length, index=0, hashIndex=0;
        for(;index&lt;hashLen; index++){
            hashIndex = hashRoute[index];
            if(!index){
                CRO = CRO['/'+hashIndex];        //hash index=0时必须完全匹配，第二级才会有 '/'与':var'的路由
                if(CRO === void 0) return;
            }else{
                CRO = CRO['/'+hashIndex] || CRO; //如果在当前index没有找到对应对象时，在此index上还保留上一个index的对象
            }

            if(CRO.index === void 0){            //没有index则加上， 有的话说明取的是上一次设置的CRO,即本次index没有取到值
                CRO.index = index;               //没有则打上标签
            }
            if ((index === hashLen-1) &amp;&amp; CRO.hasOwnProperty('/')){  //最后一个index时检查 '/'
                CRO = CRO['/'];
                return CRO;
            }
            //如果CRO的index还停留在上一个index，说明在此index上没找到路由对象
            if(CRO.index === index-1 &amp;&amp; CRO.hasOwnProperty('/:var')){
                CRO = CRO['/:var'];
                CRO.index = index;
                CRO.routeParams = hashIndex;
                return CRO;
            }
        }
        CRO.hashs = hashRoute;
        return CRO;
    }
    /**
     * 设置cro, 用于页面向某个页面传递数据
     * @method Gom.App#setCRO
     * @param {string} hashPath hashPath是形如 module/list  module/123的值
     */
    setCRO (hashPath){

    }
    /**
     * 根据完整hash路由或CRO对象到页面，封装了_routeByHash 与 _routeByCRO实现
     * @method Gom.App#goto
     * @example module/list  module/123
     * * ? 站内链接跳转
     * # 站内组件或hash跳转(仅页面内)
     * http(s)://或// 站间跳转 判断是否本域,本域的话跳转到search部分
     */
    goto (where){
        var isstr = typeof where === 'string';
        if(isstr){
            var isThisHost = !!~where.indexOf(location.host);
            if(/^((https?):)\/\//.test(where) &amp;&amp; !isThisHost){
                location.href = where;
                return;
            }
            where = !!~where.indexOf('?')?Url.getHTML5Hash(where):where; //过滤url仅获取search里的path部分
        }
        this[isstr ? '_routeByHash' : '_routeByCRO'](where);
    }

    /**
     * 根据完整hash路由到页面
     * @private
     * @method Gom.App#_routeByHash
     * @example module/list  module/123
     */
    _routeByHash  (hashPath) {
        this._manageHistory(hashPath);
        var CRO = this.getCRO(hashPath);
        this._routeByCRO(CRO);
    }
    /**
     * 根据CRO对象路由到页面
     * @private
     * @method Gom.App#_routeByCRO
     * @param {object} CRO -CRO对象
     */
    _routeByCRO (CRO){
        var that = this;
        if(this.isRouteNotFound(CRO)){
            return;
        }

        var ctrl = CRO.ctrl;
        if(ctrl){
            CRO.events = ctrl.events;   //将ctrl的事件设置到当前路由对象
        }

        var pageInit = function(){
            var page = that.setPage(CRO);   //初始页面并绑定事件
            if(ctrl &amp;&amp; ctrl.init){
                page.hashs =  CRO.hashs;    //将hash对象传递到页面
                ctrl.init(page);            //将传递到页面(ctrl)的所有信息;
            }else{
                page.render();
            }
        };

        if(!CRO.tmplname){
            pageInit();
            return;
        }

        this.getViewTmpl(CRO.tmplname, function(tmpl){
            CRO.tmpl = tmpl;
            pageInit();
        });
    }
    _manageHistory (hashPath){
        if(this.getLastHashByLastIndex(1) === hashPath){
            return;
        }

        var history = this.history;
        history.push(hashPath);
        if(history.length > 10){
            history.shift();
        }
        console.log(history, 'THIS HISTORY');
    }
    /**
     * 从后往前依据 倒数index取历史hash
     * @method Gom.App#getLastHashByLastIndex
     * @param {number} index 从0开始取值
     * @returns {string} route的历史记录
     */
    getLastHashByLastIndex (index){
        var history = this.history;
        return history[history.length-index];
    }
    /**
     * 查询到跳转是否为前进或是后退或是首次进入
     * @method App#isBack
     * @return {boolean|null} true:后退, false:前进, null:首次进入;
     */
    isBack (){
        var last = this.getLastHashByLastIndex(1),
            later  = this.getLastHashByLastIndex(2);

        var oldHashArr = Url.getHashPath(later, true),
            newHashArr = Url.getHashPath(last, true),
            isExistOld = oldHashArr.filter(x=>!!x).length;

        return later ? newHashArr.filter(x => !!x).length &lt; isExistOld : null;
    }
    //判断是否存在CRO而404
    isRouteNotFound (CRO){
        if (!CRO) {
            this.route['/404']['data'] = {url: location.href};
            this.goto('404');
            return true;
        }
        return false;
    }
}

export default App;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.0-dev</a> on Sun Jan 17 2016 16:54:24 GMT+0800 (CST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
