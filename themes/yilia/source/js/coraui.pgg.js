!function(e){e.fn.guide=function(t){t=t||{},opts=e.extend({},e.fn.guide.defaults,t);var o=e(this);if(!(o.length>1)){var i=function(){l(opts.guideClass),hxArrSet=a(),hxArrSet&&parseInt(hxArrSet.join(""),10)>0&&(s(),n("linked"),p(),d(),opts.isScorllShow&&f())},a=function(){for(var e,t=0,i=[],a=1;6>=a;a++)e=o.find("h"+a).length,t+=e,i.push(e);return t<opts.hxnum?void 0:i},s=function(){var t=e(opts.placeDom);t.prepend("<div class="+opts.guideClass.slice(1)+"></div>");var o=t.find(opts.guideClass);"body"===opts.placeDom?o.addClass("fixed").removeClass("relate"):(o.addClass("relate").removeClass("fixed").prepend('<span class="switch-pos">切换显示</span>'),t.find(".switch-pos").click(function(){o.hasClass("fixed")?o.addClass("relate").removeClass("fixed"):o.addClass("fixed").removeClass("relate")}))},n=function(t){for(var i,a=1;6>=a;a++)if(hxArrSet[a-1]>0)for(var s=1,n=1;n<=hxArrSet[a-1];n++)if("linked"===t)i=o.find("h"+a).eq(n-1).addClass("h"+a),i.attr({name:"to"+a+n,id:"to"+a+n});else if("link"===t){if(i=e(opts.guideClass).find(".h"+a).eq(n-1).attr({href:"#to"+a+n}).attr({"code-num":"#to"+a+n}),2===a)i.prepend("<span>"+n+" </span>");else if(3===a){i.prev().hasClass("h"+a)?s++:s=1;var p=parseInt(r(i,"a.h2").find("span").text(),10);i.prepend("<span>"+p+"."+s+" </span>")}else a>3&&i.prepend("<span>• </span>");i.replaceWith('<a code-num="#to'+a+n+'" href="#to'+a+n+'" class="h'+a+'">'+i.html()+"</a>")}},r=function(e,t){return e.prev().hasClass(t)?r(e.prev(),t):e.prev()},p=function(){var t=o.find("h1,h2,h3,h4,h5,h6").clone();e(opts.guideClass).append(t),n("link")},d=function(){e(opts.guideClass).find("a").each(function(t,i){var a=e(i),s=a.attr("href").substring(1),n=a.find("span").text();o.find('[name="'+s+'"]').prepend("<span>"+n+"</span>")})},l=function(t){var o=e('<style type="text/css"></style'),i=t+"{max-width:280px; background-color : #fff; padding : 10px; z-index: 10000}"+t+".fixed{top:50%; right:10px;  margin-top : -150px; overflow : auto; z-index : 10000; position: fixed; box-shadow: 0 1px 10px #999; max-height : 300px;}"+t+".relate{border : 2px solid #ddd; position: relative; margin:0 0 0  50px; float: right;}"+t+" a { display: block; font-size: 12px; color: #333; text-decoration: none; line-height : 24px; padding-left : 10px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-algin: left }"+t+" a.active { color:green }"+t+" .h1{ font-size: 15px; font-weight: bold; border-bottom : 1px solid #ddd; margin-bottom: 8px; max-width: 200px; padding-right:80px; }"+t+" .h2{ color: #555; font-size: 13px; font-weight:bold; margin-bottom:1px;}"+t+" .h3{ margin-left: 15px; color: #666; font-size: 13px;  margin-bottom:2px; }"+t+" .h4{ margin-left: 30px; color: #777;  margin-bottom:4px;  }"+t+" .h5{ margin-left: 45px; color: #999;  margin-bottom:6px;  }"+t+" .h6{ margin-left: 60px; color: #aaa;   }"+t+" .switch-pos{ position:absolute; right:10px; top: 5px; color: #fff; background-color:rgba(0,0,0,.5); cursor: pointer; padding: 0 5px; font-size:13px; line-height:25px; border-radius:2px;}";o[0].styleSheet?o[0].styleSheet.cssText=i:o.text(i),e("head").append(o)},f=function(){var t;e(window).scroll(function(){o.find("h1,h2,h3,h4,h5,h6").each(function(){return Math.ceil(e(this).offset().top)-e(window).scrollTop()>=5?(t=e('a[code-num="#'+e(this).attr("name")+'"]'),t.prev().addClass("active").siblings().removeClass("active"),!1):void(t&&t.addClass("active").siblings().removeClass("active"))})})};i()}},e.fn.guide.defaults={guideClass:".guide-frame",placeDom:"body",hxnum:5,isScorllShow:!0}}(jQuery);