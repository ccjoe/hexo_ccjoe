if(!Function.prototype.bind){Function.prototype.bind=function(a){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var e=Array.prototype.slice.call(arguments,1),c=this,d=function(){},b=function(){return c.apply(this instanceof d?this:a||this,e.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;b.prototype=new d();return b}}var utils={descendantVal:function(d,c,b){if(!d){return null}var a=0,c=c.split(".");for(;a<c.length;a++){if(b!=null&&a+1===c.length){d[c[a]]=b}d=d[c[a]];if(!d){return}}return d},hasAttr:function(b,c){var a=b.attr(c);return(a!==void 0&&a!==false)?a:false},eachAttr:function(a,b){$.each(a.attributes,function(d,c){b(d,c.nodeName)})}};var ViewBind=function(a){$.extend(this,a);this.modelId=a.modelId;this.$el=typeof a.$el==="string"?$(a.$el):a.$el,this.data=typeof a.data==="function"?a.data():(a.data||{});this.$view=this.$el?$(this.$el.html()):$(a.view);this.events=a.events;this.init()};ViewBind.prototype={init:function(){this.created?this.created():null;this.render();this.vb=this.bind();this._parseEvent()},set:function(b,c){var a;if(arguments.length>1){a=this.data[b];this.data[b]=c}else{a=this.data;c=b;b=void 0;this.data=$.extend(this.data,c)}this.vb.trigger(this.modelId+":change",[b,c,a])},get:function(a){return this.data[a]},attr:function(c,a,b){return"[vb-"+c+(a?((b?"^":"")+'="'+a+(b?'."':'"')):"")+"]"},selector:function(a,b){return this.attr(this.modelId,a,b)+","+this.attr("model",a,b)},elem:function(b,d){var c=d&&d.sub,f=d&&d.$views,e=d&&d.isitem;var a=!e?this.selector(b,c):this.attr("item",b,c);f=f||this.$view;return f.filter(a).add(f.find(a))},bind:function(){var c=this;var a=jQuery({});var b=this.modelId+":change";this.$el.on("input change",c.selector(),function(g){var i=$(this),d=i.val(),e=i.data("vb-val"),f=utils.hasAttr(i,"vb-"+c.modelId),h=utils.hasAttr(i,"vb-model");var j=f||h;if(j){a.trigger(b,[j,d,e])}if(h){a.trigger(b,[h,d,e])}i.data("vb-val",d);if(j){c.watchKey(j,d,e)}});a.on(b,function(e,d,f){if(d===void 0){c.render();c.attached?c.attached():null;return}c.data[d]=f;c.setElemValue(d,void 0,{value:f});c.renderSubKey(d,void 0,{value:f})});return a},render:function(){var b=this.$view,a=this.data;this.renderObject(a,{$views:b});this.$el.html(b)},renderObject:function(c,b){var a=this;$.each(c,function(d,e){b.sub=false;a.setElemValue(d,c,b);a.renderSubKey(d,c,b)})},renderSubKey:function(b,c,e){var d=this;if(e){e.sub=true}var a=this.elem(b,e);if(a.length){a.each(function(){var f,g=this;utils.eachAttr(g,function(h,i){f=$(g).attr(i);if(f.indexOf(b)===0){if(e){e.sub=false}d.setElemValue(f,c,e)}})})}},setElemValue:function(b,c,e){var d=this,g,a=b.split(".").length>1;var f=this.elem(b,e);value=e&&e.value!==void 0?e.value:(a?utils.descendantVal(c,b):c&&c[b]);f.each(function(h,j){g=$(j);value=d.processEntity(g,value,b);d.setBindValue(g,value,c);if($.isArray(value)){d.renderList(g,value,b,c);return}})},renderList:function(e,f,g,h){var d=this;var k=e[0].id?e[0].id+"-"+g+"-tmpl":g+"-tmpl";var j=this.$el.data(k);if(!j){this.$el.data(k,e.html())}j=this.$el.data(k);e.empty();var i,a,c,b;$.each(f,function(l,m){m.$index=l;i=$(j).clone();if(!m||$.isEmptyObject(m)){i=""}else{d.renderObject(m,{$views:i,isitem:true})}e.append(i)})},setval:function(c,b){if(c.is("input, textarea, select")){c.val(b);var a=utils.hasAttr(c,"vb-model");if(c.is("select")&&$.isArray(b)&&a){var d=b&&b.length?b[0][c.attr("vb-key")]:void 0;utils.descendantVal(this.data,a,d);this.watchKey(a,d)}}else{c.html(b)}},setBindValue:function(e,g,c){var h=utils.hasAttr(e,"vb-noset")===false,f,a,d=["entity","class","show","hide","if","value","model","cloak"];if(!$.isArray(g)){if(h){this.setval(e,g)}else{e.attr("value",g)}}for(var b=0;b<d.length;b++){f=d[b];a=utils.hasAttr(e,"vb-"+f);if(a){var j=this.getBindValue(e,a,g,c);if(f==="entity"&&h){this.setval(e,j?j:g)}if(f==="value"){e.attr("value",j)}if(f==="model"){utils.descendantVal(this.data,j,e.val()||utils.descendantVal(this.data,j))}if(f==="class"){e.addClass(j)}if(f==="if"){if(!j){e.addClass("hidden")}else{e.removeClass("hidden")}}if(f==="show"){e.css("display",j?"inherit":"none")}if(f==="hide"){e.css("display",!j?"none":"inherit")}}if(f==="cloak"){e.removeAttr("vb-cloak")}}},getBindValue:function($ele,attrval,$value,$values){try{return eval(attrval)}catch(e){return attrval}},processEntity:function(d,c,b){if(!this.entity){return c}var a=c;$.each(this.entity,function(f,e){if(f===b){a=e(c)}});return a},destroyed:function(){this.$el.off();this.$el.empty()},watchKey:function(b,c,a){if(this.watch){if(b){var d=this.watch[b]}if(d){d=d.bind(this);d(c,a)}}},on:function(b,a,c){this.$el.on(b,a,c)},off:function(b,a,c){this.$el.off(b,a,c)},_parseEvent:function(e){var b=this.events;if(!b){return}var a=this.on.bind(this);e=e||this;for(var d in b){(function(g){var h=c(g),f=b[g];a(h.event,h.selector,function(i){if(typeof f==="function"){f(i,this,e);return false}e[f](i,this);return false})})(d)}function c(g){var f=/(\w+)+\s+(.+)/.exec(g);return{event:f[1],selector:f[2]}}}};